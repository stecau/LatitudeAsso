<!DOCTYPE html>
<html lang="fr">
<head>
    <title>Viewer</title>
    <meta charset="UTF-8">
    <meta name= "viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name= "author" content="Stéphane CAU">
    <meta name= "description" content="Viewer pour le spectacle de danse">
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&family=Roboto:wght@400;700&family=Shrikhand&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <noscript>Pour utiliser ce site, merci d'activer JavaScript.</noscript>

    <div class="lecture__article" id="visionnage">
        <!-- Lecteur container -->
        <div class="video-frame">
            <!-- Video bloc -->
            <video controls controlslist="nodownload" id="video">
                <source id="src_webm" src="" type="video/webm">
                <source id="src_mp4" src="" type="video/mp4">
                Sorry, your browser doesn't support embedded videos.
            </video>
        </div>
        <div class="telechargement button">
            <a href="" download="" id="download"><i class="fas fa-download"></i>Téléchargement</a>
        </div>
    </div>

    <script>
        // Script pour affichage film adéquat dans zone de Visionnage
        let btn_vendredi_large = window.parent.document.getElementById("btn_vendredi_large");
        let btn_vendredi_serre = window.parent.document.getElementById("btn_vendredi_serre");
        let btn_samedi_large = window.parent.document.getElementById("btn_samedi_large");
        let btn_samedi_serre = window.parent.document.getElementById("btn_samedi_serre");

        let ecran = window.parent.document.getElementById("visionnage");
        let fr_video = window.parent.document.getElementById("frame_video");
        let ecran_loc = document.getElementById("visionnage");

        let iframe_div_m1 = window.parent.document.getElementById("iframe_div_m1");
        let iframe_div_m2 = window.parent.document.getElementById("iframe_div_m2");
        let iframe_div_t1 = window.parent.document.getElementById("iframe_div_t1");
        let iframe_div_m3 = window.parent.document.getElementById("iframe_div_m3");
        let iframe_div_m4 = window.parent.document.getElementById("iframe_div_m4");
        let iframe_div_t2 = window.parent.document.getElementById("iframe_div_t2");

        var player = document.getElementById('video');
        var mp4Vid = document.getElementById('src_mp4');
        var webmVid = document.getElementById('src_webm');
        var download = document.getElementById('download');

        ecran.style.height = "0";
        ecran_loc.style.height = calcul_height() + "px"
        fr_video.style.height = calcul_height() + "px"

        btn_vendredi_large.addEventListener("click", () => {
            affichageIframeContainer("1");
            changeSource("videos/film_presentation_de_saison_21_22_new.mp4");
        })

        btn_vendredi_serre.addEventListener("click", () => {
            affichageIframeContainer("2");
            changeSource("videos/Enregistrement_ecran_2022-05-10_a_23.46.23.mov");
        })

        btn_samedi_large.addEventListener("click", () => {
            affichageIframeContainer("3");
            changeSource("videos/Voyage_Intro_2.mp4");
        })

        btn_samedi_serre.addEventListener("click", () => {
            affichageIframeContainer("4");
            changeSource("videos/Voyage_VisagesChoregraphes.mp4");
        })

        // Fonctions spécifiques pour cette partie de JavaScript
        function changeSource(url_src) {
            player.pause();
            download.setAttribute('href', url_src);
            download.setAttribute('download',url_src);
            if(getComputedStyle(ecran).height != "0" && mp4Vid.getAttribute('src') == url_src ){
                ecran.style.height = "0"
                mp4Vid.src = "";
                src_webm.src = "";
            } else {
                mp4Vid.src = url_src;
                src_webm.src = "";
                ecran.style.height = calcul_height() + "px"
                player.load();
                // player.play();
            }
        }

        function calcul_height() {
            let vw = window.innerWidth;
            let vh = window.innerHeight;
            let telechargement = document.querySelector('.telechargement');
            let offsetHeight = telechargement.offsetHeight;
            let style = getComputedStyle(telechargement);
            let topMargin = parseInt(style.marginTop);
            let botMargin = parseInt(style.marginBottom);
            console.log("offsetHeight : " + offsetHeight);
            console.log("topMargin : " + topMargin);
            console.log("botMargin : " + botMargin);
            let telechargement_height = offsetHeight + topMargin + botMargin;
            let video_height = vw * ( 42.2 / 100 );
            console.log("telechargement_height : " + telechargement_height);
            console.log("video_height : " + video_height);
            console.log("telechargement_height + video_height : " + (telechargement_height + video_height));
            return telechargement_height + video_height
        }

        function affichageIframeContainer(sId) {
            let vw = window.innerWidth;
            if (vw < 769) {
                iframe_div_t1.style.display = "none";
                // iframe_div_t2.style.display = "none";
                if (sId == "1") {
                    iframe_div_m1.style.display = "block";
                    iframe_div_m2.style.display = "none";
                    // iframe_div_m3.style.display = "none";
                    // iframe_div_m4.style.display = "none";
                }
                if (sId == "2") {
                    iframe_div_m2.style.display = "block";
                    iframe_div_m1.style.display = "none";
                    // iframe_div_m3.style.display = "none";
                    // iframe_div_m4.style.display = "none";
                }
                if (sId == "3") {
                    iframe_div_m3.style.display = "block";
                    iframe_div_m1.style.display = "none";
                    iframe_div_m2.style.display = "none";
                    iframe_div_m4.style.display = "none";
                }
                if (sId == "4") {
                    iframe_div_m4.style.display = "block";
                    iframe_div_m1.style.display = "none";
                    iframe_div_m2.style.display = "none";
                    iframe_div_m3.style.display = "none";
                }
            }
            if (vw >= 769 && vw < 1135) {
                iframe_div_m1.style.display = "none";
                iframe_div_m2.style.display = "none";
                iframe_div_m3.style.display = "none";
                iframe_div_m4.style.display = "none";
                if (sId == "1") {
                    iframe_div_t1.style.display = "block";
                    iframe_div_t2.style.display = "none";
                }
                if (sId == "2") {
                    iframe_div_t1.style.display = "block";
                    iframe_div_t2.style.display = "none";
                }
                if (sId == "3") {
                    iframe_div_t1.style.display = "none";
                    iframe_div_t2.style.display = "block";
                }
                if (sId == "4") {
                    iframe_div_t1.style.display = "none";
                    iframe_div_t2.style.display = "block";
                }
            }
        }
    </script>
</body>